// Language detection and management
const translations = {
    en: {
        // Header
        siteTitle: "WORKOUT BRO - Bigger Arms: 22 Day Program",
        logoText: "WORKOUT BRO",
        
        // Hero section
        newProgram: "NEW PROGRAM",
        heroTitle: "BIGGER ARMS: 22 DAY PROGRAM",
        heroDescription: "A step-by-step, equipment-light plan designed to add serious size and shape to your biceps and triceps in just 22 days. No excuses — just bigger arms.",
        downloadButton: "Download now. It's free →",
        disclaimer: "*No credit card required",
        
        // What's Inside
        whatsInsideTitle: "WHAT'S INSIDE",
        exerciseCalendar: "Exercise Calendar.",
        exerciseCalendarDesc: "22-day structured plan with daily arm workouts targeting biceps, triceps, and overall arm development.",
        exerciseBreakdowns: "Exercise Breakdowns.",
        exerciseBreakdownsDesc: "Detailed instructions and form cues for every exercise to maximize growth and prevent injury.",
        printableCalendar: "Printable Progress Calendar.",
        printableCalendarDesc: "Empty calendar template to print and track your daily workouts and measurements.",
        targetAudience: "Perfect for anyone serious about building impressive arm size, whether you're a beginner or looking to break through plateaus.",
        
        // Video section
        videoTitle: "SEE THE PROGRAM IN ACTION",
        videoDescription: "Watch this detailed explanation of the 22-day program to see exactly how it works and what makes it so effective for building bigger arms.",
        
        // Testimonials
        testimonialsTitle: "WHAT PEOPLE SAY:",
        testimonial1Name: "Michael R.",
        testimonial1Text: "Amazing results in just 22 days! The calendar kept me accountable and my arms are noticeably bigger. Highly recommend!",
        testimonial2Name: "Jake M.",
        testimonial2Text: "Perfect for home workouts! Minimal equipment needed and real results. After 22 days the difference was amazing!",
        testimonial3Name: "Dmitry K.",
        testimonial3Text: "I was skeptical about 22 days, but my biceps and triceps are visibly bigger! This program delivers - bigger arms guaranteed.",
        
        // Middle CTA
        ctaTitle: "GET YOUR 22-DAY ARM PROGRAM TODAY",
        ctaSubtitle: "NO EXCUSES",
        ctaButton: "Download now",
        
        // Exclusive Content
        exclusiveTitle: "UNLOCK EXCLUSIVE CONTENT",
        exclusiveSubtitle: "Inside you'll find:",
        exclusiveItem1: "Extra videos",
        exclusiveItem1Desc: "not available anywhere else",
        exclusiveItem2: "Bonus guides and materials",
        exclusiveItem2Desc: "you won't see in free access",
        exclusiveItem3: "Tips and insights",
        exclusiveItem3Desc: "to push your progress further",
        exclusiveSupportText: "Join today, support the channel, and get access to everything behind the scenes.",
        patreonButton: "PATREON",
        patreonUrl: "https://www.patreon.com/cw/workoutbro",
        
        // Footer
        websiteUrl: "WWW.WORKOUTBRO.CLUB",
        privacyPolicy: "Privacy Policy",
        cookiesPolicy: "Cookies Policy",
        currentLanguage: "English",
        copyright: "© WorkoutBro, 2025",
        
        // Language Modal
        selectLanguageTitle: "Select Language",
        languageQuestion: "Is your language English?",
        languageQuestionRu: "Is your language Russian?",
        
        // Download Modal
        modalTitle: "Get Your Free Program",
        modalDescription: "Enter your email address to download the 22-day arm program. It's completely free!",
        emailLabel: "Email Address",
        emailPlaceholder: "your.email@example.com",
        consentText: "I agree to receive fitness tips and updates via email",
        downloadNowButton: "Download Now",
        preparingDownload: "Preparing Download...",
        privacyNote: "*We respect your privacy. No spam, unsubscribe anytime.",
        emailRequired: "Email address is required",
        emailInvalid: "Please enter a valid email address",
        consentRequired: "Please agree to receive updates",
        downloadSuccess: "✓ Thank you! Download will start shortly."
    },
    ru: {
        // Header
        siteTitle: "WORKOUT BRO - Большие Руки: 22-дневная Программа",
        logoText: "WORKOUT BRO",
        
        // Hero section
        newProgram: "НОВАЯ ПРОГРАММА",
        heroTitle: "БОЛЬШИЕ РУКИ: 22-ДНЕВНАЯ ПРОГРАММА",
        heroDescription: "Пошаговый план с минимальным оборудованием, разработанный для серьезного увеличения размера и формы ваших бицепсов и трицепсов всего за 22 дня. Никаких оправданий — только большие руки.",
        downloadButton: "Скачать бесплатно →",
        disclaimer: "*Кредитная карта не требуется",
        
        // What's Inside
        whatsInsideTitle: "ЧТО ВНУТРИ",
        exerciseCalendar: "Календарь Упражнений.",
        exerciseCalendarDesc: "22-дневный структурированный план с ежедневными тренировками рук, нацеленными на бицепсы, трицепсы и общее развитие рук.",
        exerciseBreakdowns: "Разбор Упражнений.",
        exerciseBreakdownsDesc: "Подробные инструкции и подсказки по технике для каждого упражнения, чтобы максимизировать рост и предотвратить травмы.",
        printableCalendar: "Календарь Прогресса для Печати.",
        printableCalendarDesc: "Пустой шаблон календаря для печати и отслеживания ваших ежедневных тренировок и измерений.",
        targetAudience: "Идеально подходит для всех, кто серьезно настроен на построение впечатляющего размера рук, будь вы новичок или хотите преодолеть плато.",
        
        // Video section
        videoTitle: "ПОСМОТРИТЕ ПРОГРАММУ В ДЕЙСТВИИ",
        videoDescription: "Посмотрите это подробное объяснение 22-дневной программы, чтобы увидеть, как именно она работает и что делает её такой эффективной для построения больших рук.",
        
        // Testimonials
        testimonialsTitle: "ЧТО ГОВОРЯТ ЛЮДИ:",
        testimonial1Name: "Михаил Р.",
        testimonial1Text: "Потрясающие результаты всего за 22 дня! Календарь помог мне быть дисциплинированным, и мои руки заметно больше. Очень рекомендую!",
        testimonial2Name: "Джейк М.",
        testimonial2Text: "Идеально для домашних тренировок! Минимум оборудования и реальные результаты. После 22 дней разница была потрясающей!",
        testimonial3Name: "Дмитрий К.",
        testimonial3Text: "Я скептически относился к 22 дням, но мои бицепсы и трицепсы заметно больше! Эта программа работает - большие руки гарантированы.",
        
        // Middle CTA
        ctaTitle: "ПОЛУЧИТЕ СВОЮ 22-ДНЕВНУЮ ПРОГРАММУ ДЛЯ РУК СЕГОДНЯ",
        ctaSubtitle: "НИКАКИХ ОПРАВДАНИЙ",
        ctaButton: "Скачать сейчас",
        
        // Exclusive Content
        exclusiveTitle: "РАЗБЛОКИРУЙТЕ ЭКСКЛЮЗИВНЫЙ КОНТЕНТ",
        exclusiveSubtitle: "Внутри вы найдете:",
        exclusiveItem1: "Дополнительные видео",
        exclusiveItem1Desc: "недоступные больше нигде",
        exclusiveItem2: "Бонусные гайды и материалы",
        exclusiveItem2Desc: "которые вы не увидите в бесплатном доступе",
        exclusiveItem3: "Советы и инсайты",
        exclusiveItem3Desc: "чтобы продвинуть ваш прогресс дальше",
        exclusiveSupportText: "Присоединяйтесь сегодня, поддержите канал и получите доступ ко всему закулисью.",
        patreonButton: "TELEGRAM",
        patreonUrl: "https://t.me/yourworkoutbro", // Замените на вашу ссылку Telegram
        
        // Footer
        websiteUrl: "WWW.WORKOUTBRO.CLUB",
        privacyPolicy: "Политика Конфиденциальности",
        cookiesPolicy: "Политика Cookies",
        currentLanguage: "Русский",
        copyright: "© WorkoutBro, 2025",
        
        // Language Modal
        selectLanguageTitle: "Выберите Язык",
        languageQuestion: "Ваш язык русский?",
        languageQuestionRu: "Ваш язык русский?",
        
        // Download Modal
        modalTitle: "Получите Вашу Бесплатную Программу",
        modalDescription: "Введите ваш email адрес, чтобы скачать 22-дневную программу для рук. Это совершенно бесплатно!",
        emailLabel: "Email Адрес",
        emailPlaceholder: "ваш.email@example.com",
        consentText: "Я согласен получать советы по фитнесу и обновления по email",
        downloadNowButton: "Скачать Сейчас",
        preparingDownload: "Подготовка Скачивания...",
        privacyNote: "*Мы уважаем вашу конфиденциальность. Никакого спама, отписка в любое время.",
        emailRequired: "Email адрес обязателен",
        emailInvalid: "Пожалуйста, введите действительный email адрес",
        consentRequired: "Пожалуйста, согласитесь получать обновления",
        downloadSuccess: "✓ Спасибо! Скачивание начнется в ближайшее время."
    }
};

let currentLanguage = 'en';

// Detect user's language and location
function detectUserLanguage() {
    // Method 1: Check browser language
    const browserLang = navigator.language || navigator.userLanguage;
    
    // Method 2: Check saved preference
    const savedLang = localStorage.getItem('workoutBroLanguage');
    
    // Russian-speaking countries and languages
    const russianLanguages = ['ru', 'ru-RU', 'be', 'be-BY', 'kk', 'kk-KZ', 'ky', 'ky-KG', 'uk', 'uk-UA'];
    
    if (savedLang && (savedLang === 'en' || savedLang === 'ru')) {
        return savedLang;
    }
    
    // Check if browser language is Russian or from Russian-speaking country
    if (russianLanguages.some(lang => browserLang.startsWith(lang))) {
        return 'ru';
    }
    
    // Try to detect timezone (rough location detection)
    try {
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const russianTimezones = [
            'Europe/Moscow', 'Europe/Kaliningrad', 'Europe/Samara', 'Europe/Volgograd',
            'Asia/Yekaterinburg', 'Asia/Omsk', 'Asia/Krasnoyarsk', 'Asia/Irkutsk',
            'Asia/Yakutsk', 'Asia/Vladivostok', 'Asia/Magadan', 'Asia/Kamchatka',
            'Europe/Minsk', 'Asia/Almaty', 'Asia/Bishkek', 'Europe/Kiev'
        ];
        
        if (russianTimezones.includes(timezone)) {
            return 'ru';
        }
    } catch (e) {
        console.log('Timezone detection failed:', e);
    }
    
    return 'en'; // Default to English
}

// Check if user has made language choice before
function hasUserChosenLanguage() {
    return localStorage.getItem('workoutBroLanguageChoice') !== null;
}

// Show first-time language selection modal
function showFirstTimeLanguageModal() {
    const detectedLang = detectUserLanguage();
    const modal = document.getElementById('first-time-language-modal');
    const questionElement = document.getElementById('language-question');
    const yesBtn = document.getElementById('yes-btn');
    const noBtn = document.getElementById('no-btn');
    
    // Always show English by default, only show Russian if explicitly detected
    if (detectedLang === 'ru') {
        questionElement.textContent = 'Ваш язык русский?';
        yesBtn.textContent = 'Да';
        noBtn.textContent = 'Нет';
    } else {
        // Default to English for all other cases (including undetected)
        questionElement.textContent = 'Is your language English?';
        yesBtn.textContent = 'Yes';
        noBtn.textContent = 'No';
    }
    
    modal.style.display = 'block';
}

// Handle language confirmation
function confirmLanguage(isCorrect) {
    const detectedLang = detectUserLanguage();
    let finalLang;
    
    if (detectedLang === 'ru') {
        // If detected Russian and user confirms, use Russian
        // If detected Russian but user says no, use English
        finalLang = isCorrect ? 'ru' : 'en';
    } else {
        // If detected English and user confirms, use English
        // If detected English but user says no, use Russian
        finalLang = isCorrect ? 'en' : 'ru';
    }
    
    // Save the choice
    localStorage.setItem('workoutBroLanguageChoice', 'true');
    localStorage.setItem('workoutBroLanguage', finalLang);
    
    // Close modal and apply language
    closeModal('first-time-language-modal');
    applyTranslations(finalLang);
}

// Apply translations to the page
function applyTranslations(lang) {
    const t = translations[lang];
    
    // Update document title
    document.title = t.siteTitle;
    
    // Add language class to body
    document.body.className = document.body.className.replace(/\blang-\w+\b/g, '');
    document.body.classList.add('lang-' + lang);
    
    // Update all elements with data-translate attribute
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (t[key]) {
            if (element.tagName === 'INPUT' && element.type === 'email') {
                element.placeholder = t[key];
            } else {
                element.textContent = t[key];
            }
        }
    });
    
    // Update support button URL and icon
    const supportButton = document.getElementById('support-button');
    const supportIcon = document.getElementById('support-icon');
    if (supportButton) {
        // Remove existing click handlers
        supportButton.onclick = null;
        
        // Add new click handler based on language
        if (lang === 'en') {
            // English version - go to Patreon
            supportButton.onclick = function() {
                window.open(t.patreonUrl, '_blank');
            };
        } else {
            // Russian version - show alert about future Telegram group
            supportButton.onclick = function() {
                alert('Ссылка на закрытую группу в Telegram будет добавлена позже.');
            };
        }
        
        // Update icon based on language
        if (supportIcon) {
            supportIcon.textContent = lang === 'ru' ? 'T' : 'P';
        }
    }
    
    // Update current language display in footer
    const currentLangElement = document.getElementById('current-language');
    if (currentLangElement) {
        currentLangElement.textContent = lang === 'ru' ? 'Русский' : 'English';
    }
    
    // Update language options in modal
    document.querySelectorAll('.language-option').forEach(option => {
        option.classList.remove('active');
    });
    
    // Save language preference
    localStorage.setItem('workoutBroLanguage', lang);
    currentLanguage = lang;
}

// Select language from modal
function selectLanguage(lang) {
    applyTranslations(lang);
    closeModal('language-modal');
}

// Initialize language system
function initializeLanguage() {
    if (hasUserChosenLanguage()) {
        // User has made a choice before, use saved preference
        const savedLang = localStorage.getItem('workoutBroLanguage') || 'en';
        applyTranslations(savedLang);
    } else {
        // First time visitor, show language selection modal
        showFirstTimeLanguageModal();
    }
}

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    // Initialize language detection
    initializeLanguage();
    // Add smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    // Header scroll effect disabled
    
    // All animations disabled
    
    // CTA button interactions - open download modal
    const ctaButtons = document.querySelectorAll('.cta-button');
    ctaButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Add click animation
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
            
            // Open download modal
            openModal('download-modal');
        });
    });
    
    // Support button will be handled by applyTranslations function
});

// Add some interactive effects
function addInteractiveEffects() {
    // Parallax effect for hero section
    window.addEventListener('scroll', function() {
        const scrolled = window.pageYOffset;
        const parallax = document.querySelector('.hero-image');
        if (parallax) {
            const speed = scrolled * 0.5;
            parallax.style.transform = `translateY(${speed}px)`;
        }
    });
}

// Initialize interactive effects
addInteractiveEffects();

// Loading animation disabled

// Loading styles disabled

// Testimonial Slider
let currentSlideIndex = 0;
let slideTimer;
const slides = document.querySelectorAll('.testimonial-card');
const dots = document.querySelectorAll('.dot');

function showSlide(index) {
    // Hide all slides
    slides.forEach(slide => slide.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));
    
    // Show current slide
    if (slides[index]) {
        slides[index].classList.add('active');
        dots[index].classList.add('active');
    }
}

function changeSlide(direction) {
    currentSlideIndex += direction;
    
    if (currentSlideIndex >= slides.length) {
        currentSlideIndex = 0;
    } else if (currentSlideIndex < 0) {
        currentSlideIndex = slides.length - 1;
    }
    
    showSlide(currentSlideIndex);
    resetTimer(); // Reset timer when manually changing slides
}

function currentSlide(index) {
    currentSlideIndex = index - 1;
    showSlide(currentSlideIndex);
    resetTimer(); // Reset timer when manually changing slides
}

function startTimer() {
    slideTimer = setInterval(() => {
        changeSlideAuto();
    }, 10000);
}

function resetTimer() {
    clearInterval(slideTimer);
    startTimer();
}

function changeSlideAuto() {
    currentSlideIndex++;
    
    if (currentSlideIndex >= slides.length) {
        currentSlideIndex = 0;
    }
    
    showSlide(currentSlideIndex);
}

// Start auto-slide timer
startTimer();

// Modal functions
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto'; // Restore scrolling
    }
}

// Close modal when clicking outside of it
window.addEventListener('click', function(event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (event.target === modal) {
            closeModal(modal.id);
        }
    });
});

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                closeModal(modal.id);
            }
        });
    }
});

// Download form handling
document.addEventListener('DOMContentLoaded', function() {
    const downloadForm = document.getElementById('download-form');
    if (downloadForm) {
        downloadForm.addEventListener('submit', handleDownloadSubmit);
    }
});

function handleDownloadSubmit(event) {
    event.preventDefault();
    
    const emailInput = document.getElementById('email');
    const consentCheckbox = document.getElementById('privacy-consent');
    const emailError = document.getElementById('email-error');
    const consentError = document.getElementById('consent-error');
    const downloadBtn = document.querySelector('.download-btn');
    const btnText = document.querySelector('.btn-text');
    const btnLoading = document.querySelector('.btn-loading');
    
    // Clear previous errors
    emailError.classList.remove('show');
    consentError.classList.remove('show');
    emailInput.classList.remove('error');
    
    let hasErrors = false;
    
    // Validate email
    const email = emailInput.value.trim();
    const t = translations[currentLanguage];
    
    if (!email) {
        showError(emailError, t.emailRequired);
        emailInput.classList.add('error');
        hasErrors = true;
    } else if (!isValidEmail(email)) {
        showError(emailError, t.emailInvalid);
        emailInput.classList.add('error');
        hasErrors = true;
    }
    
    // Validate consent
    if (!consentCheckbox.checked) {
        showError(consentError, t.consentRequired);
        hasErrors = true;
    }
    
    if (hasErrors) {
        return;
    }
    
    // Show loading state
    downloadBtn.disabled = true;
    btnText.style.display = 'none';
    btnLoading.style.display = 'inline';
    
    // Send email to Google Sheets
    const googleSheetsUrl = 'https://script.google.com/macros/s/AKfycbzwEnXFF1QsvFxB_wTGwGQzKe0hNsZ-i5ipk6Alal49SXb5kEGvflK96F0iCXbpQBxc/exec';
    
    const emailData = {
        email: email,
        program: 'Bigger Arms: 22-Day Program',
        language: currentLanguage,
        consent: true
    };
    
    // Отправляем данные в Google Sheets
    fetch(googleSheetsUrl, {
        method: 'POST',
        mode: 'no-cors', // Важно для Google Apps Script
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(emailData)
    })
    .then(() => {
        console.log('Email sent to Google Sheets:', email);
        
        // Save to localStorage as backup
        const emails = JSON.parse(localStorage.getItem('workout_emails') || '[]');
        emails.push({
            email: email,
            timestamp: new Date().toISOString(),
            program: 'Bigger Arms: 22-Day Program',
            language: currentLanguage
        });
        localStorage.setItem('workout_emails', JSON.stringify(emails));
        
        // Start download
        startDownload();
        
        // Close modal and reset form
        closeModal('download-modal');
        downloadForm.reset();
        
        // Reset button state
        downloadBtn.disabled = false;
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
        
        // Show success message
        showSuccessMessage();
    })
    .catch(error => {
        console.error('Error sending to Google Sheets:', error);
        
        // Fallback: save to localStorage
        const emails = JSON.parse(localStorage.getItem('workout_emails') || '[]');
        emails.push({
            email: email,
            timestamp: new Date().toISOString(),
            program: 'Bigger Arms: 22-Day Program',
            language: currentLanguage,
            error: 'Failed to send to Google Sheets'
        });
        localStorage.setItem('workout_emails', JSON.stringify(emails));
        
        // Continue with download anyway
        startDownload();
        closeModal('download-modal');
        downloadForm.reset();
        
        downloadBtn.disabled = false;
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
        
        showSuccessMessage();
    });
}

function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function showError(errorElement, message) {
    errorElement.textContent = message;
    errorElement.classList.add('show');
}

function startDownload() {
    // Determine which file to download based on current language
    const currentLang = localStorage.getItem('workoutBroLanguage') || 'en';
    let fileName, downloadPath;
    
    if (currentLang === 'ru') {
        fileName = 'Bigger-Arms-22-Day-Program-RU.pdf';
        downloadPath = 'downloads/Bigger-Arms-22-Day-Program-RU.pdf';
    } else {
        fileName = 'Bigger-Arms-22-Day-Program-EN.pdf';
        downloadPath = 'downloads/Bigger-Arms-22-Day-Program-EN.pdf';
    }
    
    // Create a temporary link to trigger download
    const link = document.createElement('a');
    link.href = downloadPath;
    link.download = fileName;
    link.target = '_blank'; // Open in new tab as fallback
    
    // Trigger download
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    console.log('Download started for:', fileName);
}

function showSuccessMessage() {
    // Create and show a temporary success message
    const t = translations[currentLanguage];
    const successDiv = document.createElement('div');
    successDiv.innerHTML = `
        <div style="
            position: fixed;
            top: 20px;
            right: 20px;
            background: #0066ff;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 10001;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
        ">
            ${t.downloadSuccess}
        </div>
    `;
    
    document.body.appendChild(successDiv);
    
    // Remove success message after 4 seconds
    setTimeout(() => {
        document.body.removeChild(successDiv);
    }, 4000);
}